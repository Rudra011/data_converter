<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <title>CSV to Campaigns Converter</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="privacy-banner">
        <svg class="privacy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        <span>Your data never leaves your browser. 100% client-side processing.</span>
    </div>

    <div class="app-shell">
        <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Open menu">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
        </button>
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>CSV Converter</h1>
                <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Close menu">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
                <button class="dark-mode-toggle" id="darkModeToggle" title="Toggle dark mode">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            <div class="progress-indicator" id="progressIndicator">
                <div class="progress-bar-steps">
                    <div class="progress-fill-steps" id="progressFillSteps"></div>
                </div>
                <span class="progress-text" id="progressText">Step 1 of 7</span>
            </div>
            <nav class="sidebar-steps" id="sidebarSteps">
                <button class="sidebar-step active" data-step="upload">
                    <span class="step-icon">üìÅ</span>
                    <span class="step-label">Upload File</span>
                </button>
                <button class="sidebar-step" data-step="sheets">
                    <span class="step-icon">üìä</span>
                    <span class="step-label">Configure Sheets</span>
                </button>
                <button class="sidebar-step" data-step="mapping">
                    <span class="step-icon">üîó</span>
                    <span class="step-label">Map Fields</span>
                </button>
                <button class="sidebar-step" data-step="options">
                    <span class="step-icon">‚öôÔ∏è</span>
                    <span class="step-label">Options</span>
                </button>
                <button class="sidebar-step" data-step="preview">
                    <span class="step-icon">üëÅÔ∏è</span>
                    <span class="step-label">Preview Data</span>
                </button>
                <button class="sidebar-step" data-step="export">
                    <span class="step-icon">üíæ</span>
                    <span class="step-label">Export</span>
                </button>
                <button class="sidebar-step" data-step="filter">
                    <span class="step-icon">üîç</span>
                    <span class="step-label">Filter Data</span>
                </button>
            </nav>
            <div class="quick-help" id="quickHelp">
                <div class="quick-help-header">üí° Quick Tip</div>
                <div class="quick-help-content" id="quickHelpContent">
                    Upload your CSV or Excel file to get started.
                </div>
            </div>
        </aside>

        <div class="main-area">
            <div class="top-status" id="topStatus">
                <div class="status-item">
                    <span class="label">File</span>
                    <span class="value" id="statusFileName">No file</span>
                </div>
                <div class="status-item">
                    <span class="label">Rows</span>
                    <span class="value" id="statusRows">0</span>
                </div>
                <div class="status-item">
                    <span class="label">Columns</span>
                    <span class="value" id="statusCols">0</span>
                </div>
                <div class="status-item">
                    <span class="label">Sheets</span>
                    <span class="value" id="statusSheets">0</span>
                </div>
                <div class="status-item badge" id="statusBadges"></div>
            </div>

            <div class="content-area">
                <section class="step-panel" id="step-start">
                    <div class="start-panel">
                        <div class="welcome-section">
                            <h1 class="welcome-title">Welcome to CSV Converter</h1>
                            <p class="welcome-subtitle">Transform your contact data in 3 easy steps</p>
                        </div>
                        <div class="start-cards">
                            <button class="start-card primary-flow" id="startConvert">
                                <div class="start-card-icon">üìä</div>
                                <div class="start-card-title">Convert & Export</div>
                                <div class="start-card-sub">Transform CSV/Excel files for CRM platforms</div>
                                <div class="start-card-badge">Most Popular</div>
                            </button>
                            <button class="start-card" id="startFilter">
                                <div class="start-card-icon">üîç</div>
                                <div class="start-card-title">Filter & Extract</div>
                                <div class="start-card-sub">Filter existing data by tags and sources</div>
                            </button>
                        </div>
                        <div class="features-list">
                            <div class="feature-item">‚úì 100% client-side processing</div>
                            <div class="feature-item">‚úì No data leaves your browser</div>
                            <div class="feature-item">‚úì Supports CSV, XLSX, and XLS</div>
                        </div>
                    </div>
                </section>
                <section class="step-panel" id="step-upload">
                    <div class="step-header">
                        <h2>Upload Your Data File</h2>
                        <p class="step-description">Support for CSV, XLSX, and XLS formats up to 100MB</p>
                    </div>
                    <div class="file-input-section">
                        <div class="drop-zone" id="dropZone">
                            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <p class="drop-text">Drag & drop your CSV or Excel file here</p>
                            <p class="drop-text-or">or</p>
                            <button class="btn-browse" id="browseBtn">Browse Files</button>
                            <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" hidden>
                        </div>
                        <div class="file-info" id="fileInfo" style="display: none;">
                            <span class="file-name" id="fileName"></span>
                            <button class="btn-clear" id="clearFile">Clear</button>
                        </div>

                        <div class="progress-bar-container" id="progressBarContainer" style="display: none;">
                            <div class="progress-info">
                                <span class="progress-label" id="progressLabel">Processing...</span>
                                <span class="progress-percentage" id="progressPercentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="step-panel" id="step-sheets" style="display:none;">
                    <div class="step-header">
                        <h2>Configure Sheets & Tags</h2>
                        <p class="step-description">Select sheets to process and add sheet-specific tags</p>
                    </div>
                    <div class="sheet-tags-section" id="sheetTagsSection" style="display: none;">
                        <div class="sheet-tags-header">
                            <div>
                                <h2>Sheets & Tags</h2>
                                <p class="sheet-tags-description">Edit tags and name handling per sheet.</p>
                            </div>
                            <div class="sheet-mapping-option">
                                <label class="sheet-mapping-toggle">
                                    <input type="checkbox" id="sheetWiseMappingCheckbox">
                                    <span>Enable sheet-wise field mapping (for different sheet schemas)</span>
                                </label>
                            </div>
                        </div>
                        <div class="sheet-tags-container" id="sheetTagsContainer"></div>
                    </div>
                </section>

                <section class="step-panel" id="step-mapping" style="display:none;">
                    <div class="step-header">
                        <h2>Map Your Fields</h2>
                        <p class="step-description">Connect your input columns to the output format. Use Auto-Map for quick setup.</p>
                    </div>
                    <div class="mapping-section" id="mappingSection" style="display: none;">
                        <div class="mapping-header-bar">
                            <div class="mapping-title-group">
                                <div class="sheet-selector-wrapper" id="sheetSelectorWrapper" style="display: none;">
                                    <label for="sheetSelector">Mapping for:</label>
                                    <select id="sheetSelector" class="sheet-selector"></select>
                                </div>
                            </div>
                            <div class="preset-controls">
                                <select id="presetSelect" class="preset-select">
                                    <option value="">-- Load Preset --</option>
                                </select>
                                <button class="btn-preset-save" id="savePresetBtn" title="Save current mapping as preset">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                        <polyline points="7 3 7 8 15 8"></polyline>
                                    </svg>
                                    Save Preset
                                </button>
                            </div>
                        </div>
                        <div class="inline-preview-toggle">
                            <label>
                                <input type="checkbox" id="mappingPreviewToggle">
                                <span>Show inline preview here</span>
                            </label>
                            <div class="inline-preview-controls">
                                <label class="toggle-label">View:</label>
                                <select id="mappingPreviewView" class="preview-mode-select">
                                    <option value="transformed">Transformed Output</option>
                                    <option value="raw">Raw Input</option>
                                </select>
                            </div>
                        </div>
                        <div class="quality-summary" id="mappingQuality" style="display:none;">
                            <div class="quality-badges" id="mappingQualityBadges"></div>
                        </div>
                        <div class="inline-preview" id="mappingPreview" style="display:none;">
                            <div class="inline-preview-table">
                                <div class="inline-preview-head">
                                    <table><thead id="mappingPreviewHead"></thead></table>
                                </div>
                                <div class="inline-preview-body">
                                    <table><tbody id="mappingPreviewBody"></tbody></table>
                                </div>
                            </div>
                        </div>
                        <div class="name-handling-options">
                            <h3>Name Handling Options</h3>
                            <div class="name-options-grid">
                                <label class="name-option-label">
                                    <input type="checkbox" id="mappingSplitFullName" checked>
                                    <span>Split full name into first/last</span>
                                </label>
                                <label class="name-option-label">
                                    <input type="checkbox" id="mappingFullNameIsCompany">
                                    <span>Treat full name as company</span>
                                </label>
                            </div>
                        </div>
                        <div class="mapping-container">
                            <div class="mapping-header">
                                <div class="mapping-col-output">Output Field</div>
                                <div class="mapping-col-input">Map to Input Column</div>
                            </div>
                            <div class="mapping-body" id="mappingBody"></div>
                        </div>
                        <div class="row-probe" id="rowProbe" style="display:none;">
                            <div class="row-probe-header">
                                <h3>Row Probe</h3>
                                <div class="row-probe-controls">
                                    <label for="rowProbeIndex">Row:</label>
                                    <input type="number" id="rowProbeIndex" min="1" value="1">
                                </div>
                            </div>
                            <div class="row-probe-grid">
                                <div class="row-probe-col">
                                    <h4>Raw</h4>
                                    <div class="probe-table" id="probeRaw"></div>
                                </div>
                                <div class="row-probe-col">
                                    <h4>Mapped</h4>
                                    <div class="probe-table" id="probeMapped"></div>
                                </div>
                                <div class="row-probe-col">
                                    <h4>Transformed</h4>
                                    <div class="probe-table" id="probeTransformed"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="step-panel" id="step-options" style="display:none;">
                    <div class="options-section" id="optionsSection" style="display: none;">
                        <div class="options-header-bar">
                            <h2>Options</h2>
                            <div class="options-controls">
                                <button class="btn-secondary btn-small" id="bulkReplace">Find & Replace</button>
                                <select id="workflowSelect" class="preset-select">
                                    <option value="">-- Load Workflow --</option>
                                </select>
                                <button class="btn-preset-save" id="saveWorkflow" title="Save complete workflow">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                        <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                        <polyline points="7 3 7 8 15 8"></polyline>
                                    </svg>
                                    Save Workflow
                                </button>
                                <button class="btn-undo" id="undoBtn" title="Undo last change" disabled>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 7v6h6"></path>
                                        <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
                                    </svg>
                                    Undo
                                </button>
                                <button class="btn-reset" id="resetBtn" title="Reset all options and mappings">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 4v6h6"></path>
                                        <path d="M23 20v-6h-6"></path>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                                    </svg>
                                    Reset All
                                </button>
                            </div>
                        </div>
                        <div class="inline-preview-toggle">
                            <label>
                                <input type="checkbox" id="optionsPreviewToggle">
                                <span>Show inline preview here</span>
                            </label>
                            <div class="inline-preview-controls">
                                <label class="toggle-label">View:</label>
                                <select id="optionsPreviewView" class="preview-mode-select">
                                    <option value="transformed">Transformed Output</option>
                                    <option value="raw">Raw Input</option>
                                </select>
                            </div>
                        </div>
                        <div class="quality-summary" id="optionsQuality" style="display:none;">
                            <div class="quality-badges" id="optionsQualityBadges"></div>
                        </div>
                        <div class="inline-preview" id="optionsPreview" style="display:none;">
                            <div class="inline-preview-table">
                                <div class="inline-preview-head">
                                    <table><thead id="optionsPreviewHead"></thead></table>
                                </div>
                                <div class="inline-preview-body">
                                    <table><tbody id="optionsPreviewBody"></tbody></table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Essential Options -->
                        <div class="options-section-card">
                            <h3 class="options-section-title">
                                <span class="section-icon">üéØ</span>
                                Essential Settings
                            </h3>
                            <div class="options-grid">
                                <div class="option-group">
                                    <label for="outputProfile">
                                        Output Format
                                        <span class="info-icon" title="Choose the format that matches your CRM or marketing platform">‚ÑπÔ∏è</span>
                                    </label>
                                    <select id="outputProfile" class="profile-select">
                                        <option value="zoho_campaigns">Zoho Campaigns</option>
                                        <option value="zoho_crm">Zoho CRM (Leads)</option>
                                        <option value="zoho_crm_contacts">Zoho CRM (Contacts)</option>
                                        <option value="master_data">Master Data (Complete)</option>
                                        <option value="simple">Simple (Name, Email, Phone)</option>
                                        <option value="meta_ads">Meta/Facebook Ads Customer List</option>
                                    </select>
                                    <span class="profile-field-count" id="profileFieldCount">20 fields</span>
                                </div>
                                <div class="option-group">
                                    <label for="globalTags">
                                        Global Tags
                                        <span class="info-icon" title="These tags will be added to every contact">‚ÑπÔ∏è</span>
                                    </label>
                                    <input type="text" id="globalTags" placeholder="e.g., Event, VIP, Q1-2026">
                                    <small class="field-hint">Comma-separated tags applied to all contacts</small>
                                </div>
                                <div class="option-group">
                                    <label>
                                        Quick Tags
                                        <span class="info-icon" title="Pre-defined tags for common categories">‚ÑπÔ∏è</span>
                                    </label>
                                    <div class="checkbox-group" id="builtInTags">
                                        <label class="radio-label"><input type="checkbox" value="History"> <span>History</span></label>
                                        <label class="radio-label"><input type="checkbox" value="Science"> <span>Science</span></label>
                                        <label class="radio-label"><input type="checkbox" value="Culture"> <span>Culture</span></label>
                                        <label class="radio-label"><input type="checkbox" value="Communication"> <span>Communication</span></label>
                                        <label class="radio-label"><input type="checkbox" value="Promotions"> <span>Promotions</span></label>
                                    </div>
                                    <small class="field-hint">Select categories to tag all contacts</small>
                                </div>
                                <div class="option-group">
                                    <label for="sourceField">
                                        Source
                                        <span class="info-icon" title="Track where these contacts came from">‚ÑπÔ∏è</span>
                                    </label>
                                    <input type="text" id="sourceField" placeholder="e.g., Website Form, Trade Show">
                                    <small class="field-hint">Optional: Track the origin of contacts</small>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Options Collapsible -->
                        <details class="advanced-section" open>
                            <summary class="advanced-section-toggle">
                                <span class="toggle-icon">‚ñº</span>
                                <span class="section-title">Additional Options</span>
                            </summary>
                            <div class="advanced-section-content">
                                <div class="options-grid">
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="includeExtra">
                                        <label for="includeExtra">
                                            Include unmapped columns
                                            <span class="info-icon" title="Add any columns from input that weren't explicitly mapped">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                    <div class="option-group">
                                        <label>
                                            Duplicate Handling
                                            <span class="info-icon" title="Choose how to handle duplicate email addresses">‚ÑπÔ∏è</span>
                                        </label>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="duplicateHandling" value="keep" checked>
                                                <span>Keep all</span>
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="duplicateHandling" value="drop">
                                                <span>Remove duplicates</span>
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="duplicateHandling" value="mark">
                                                <span>Mark as duplicate</span>
                                            </label>
                                        </div>
                                        <span class="duplicate-count" id="duplicateCount"></span>
                                    </div>
                                </div>
                            </div>
                        </details>

                        <!-- Intelligence Features Collapsible -->
                        <details class="advanced-section">
                            <summary class="advanced-section-toggle">
                                <span class="toggle-icon">‚ñº</span>
                                <span class="section-title">üß† Smart Features</span>
                                <span class="section-badge">Advanced</span>
                            </summary>
                            <div class="advanced-section-content">
                                <p class="section-description">These AI-powered features automatically enhance and enrich your data</p>
                                <div class="options-grid">
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="autoInferCompany" checked>
                                        <label for="autoInferCompany">
                                            Auto-detect company name
                                            <span class="info-icon" title="Extracts company name from email domain (e.g., john@acme.com ‚Üí Acme)">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="autoInferTitle" checked>
                                        <label for="autoInferTitle">
                                            Detect job titles
                                            <span class="info-icon" title="Identifies job titles in email addresses (e.g., ceo@company.com ‚Üí CEO)">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="classifyContacts" checked>
                                        <label for="classifyContacts">
                                            Classify contact type
                                            <span class="info-icon" title="Tags contacts as Business, Individual, or Generic based on patterns">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="smartColumnParsing" checked>
                                        <label for="smartColumnParsing">
                                            Smart column detection
                                            <span class="info-icon" title="Automatically finds emails and phones in mixed-content columns">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                    <div class="option-group checkbox-group">
                                        <input type="checkbox" id="consolidateColumns" checked>
                                        <label for="consolidateColumns">
                                            Consolidate duplicate columns
                                            <span class="info-icon" title="Merges similar columns (e.g., Phone, Phone1, Mobile) - useful for large datasets">‚ÑπÔ∏è</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </details>
                    </div>
                </section>

                <section class="step-panel" id="step-preview" style="display:none;">
                    <div class="step-header">
                        <h2>Preview Your Data</h2>
                        <p class="step-description">Review transformed output before export. Toggle views to compare.</p>
                    </div>
                    <div class="preview-section" id="previewSection" style="display: none;">
                        <div class="preview-header-bar">
                            <div class="preview-info">
                                <span class="preview-row-count" id="previewRowCount">0 rows</span>
                                <span class="preview-toggle">
                                    <label class="toggle-label">View:</label>
                                    <select id="previewViewMode" class="preview-mode-select">
                                        <option value="transformed">Transformed Output</option>
                                        <option value="raw">Raw Input</option>
                                    </select>
                                </span>
                            </div>
                        </div>

                        <div class="preview-container" id="previewContainer">
                            <div class="preview-scroll-container" id="previewScrollContainer">
                                <div class="preview-spacer-top" id="previewSpacerTop"></div>
                                <table class="preview-table">
                                    <thead class="preview-thead" id="previewTableHead"></thead>
                                    <tbody class="preview-tbody" id="previewTableBody"></tbody>
                                </table>
                                <div class="preview-spacer-bottom" id="previewSpacerBottom"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="step-panel" id="step-export" style="display:none;">
                    <div class="step-header">
                        <h2>Download Your Data</h2>
                        <p class="step-description">Export in your preferred format. View quality reports and export history below.</p>
                    </div>
                    <div class="export-section" id="exportSection" style="display: none;">
                        
                        <!-- Data Profile Report -->
                        <div class="data-profile-report" id="dataProfileReport" style="display:none;">
                            <div class="profile-report-header">
                                <h3>üìä Data Profile Report</h3>
                                <button class="btn-ghost btn-small" id="toggleProfileReport">Hide Report</button>
                            </div>
                            <div class="profile-report-summary" id="profileReportSummary"></div>
                            <div class="profile-report-fields" id="profileReportFields"></div>
                        </div>
                        <button class="btn-secondary" id="showProfileReport" style="margin-bottom: 16px;">Show Data Profile Report</button>
                        
                        <div class="export-format-selector">
                            <label for="exportFormat">Export Format:</label>
                            <select id="exportFormat" class="format-select">
                                <option value="csv">CSV</option>
                                <option value="xlsx">XLSX (Excel)</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                        <div class="export-actions">
                            <button class="btn-primary" id="downloadNew">Download New File</button>
                            <div class="append-group" id="appendGroup">
                                <button class="btn-secondary" id="appendExisting">Append to Existing CSV</button>
                                <input type="file" id="existingFile" accept=".csv" hidden>
                            </div>
                        </div>
                        
                        <!-- Export History -->
                        <div class="export-history" id="exportHistory" style="display:none; margin-top: 24px;">
                            <div class="export-history-header">
                                <h3>üìã Export History</h3>
                                <button class="btn-ghost btn-small" id="clearHistory">Clear All</button>
                            </div>
                            <div class="export-history-list" id="exportHistoryList"></div>
                        </div>
                    </div>
                </section>

                <section class="step-panel" id="step-filter" style="display:none;">
                    <div class="step-header">
                        <h2>Filter & Extract Data</h2>
                        <p class="step-description">Create filtered exports by selecting specific tags and sources (AND logic).</p>
                    </div>
                    <div class="export-section" id="filterSection" style="display: none;">
                        <div class="filter-top-controls">
                            <div class="option-group">
                                <label for="filterOutputProfile">Output Format:</label>
                                <select id="filterOutputProfile" class="profile-select">
                                    <option value="zoho_campaigns">Zoho Campaigns</option>
                                    <option value="zoho_crm">Zoho CRM (Leads)</option>
                                    <option value="zoho_crm_contacts">Zoho CRM (Contacts)</option>
                                    <option value="master_data">Master Data (Complete)</option>
                                    <option value="simple">Simple (Name, Email, Phone)</option>
                                    <option value="meta_ads">Meta/Facebook Ads Customer List</option>
                                </select>
                            </div>
                            <div class="export-format-selector">
                                <label for="filterExportFormat">Export Format:</label>
                                <select id="filterExportFormat" class="format-select">
                                    <option value="csv">CSV</option>
                                    <option value="xlsx">XLSX (Excel)</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-export-card">
                            <div class="filter-card-header">
                                <div>
                                    <h3>Filtering</h3>
                                    <p class="filter-card-sub">Select tags and sources; uses current output & export formats.</p>
                                </div>
                                <div class="filter-match" id="filterMatchCount">0 rows match</div>
                            </div>
                            <div class="filter-card-grid">
                                <div class="filter-field">
                                    <label>Select required tags (AND)</label>
                                    <div class="filter-tags" id="filterTags"></div>
                                    <small>Rows must include every selected tag in their Tags field. Predefined tags appear first; discovered tags from your data follow.</small>
                                </div>
                                <div class="filter-field">
                                    <label for="filterSources">Limit to sources (comma separated)</label>
                                    <input type="text" id="filterSources" placeholder="e.g., SpringCampaign, WebForm">
                                    <small>Matches Source or Lead Source fields. Leave empty to include all sources.</small>
                                </div>
                            </div>
                            <div class="filter-card-actions">
                                <button class="btn-secondary" id="downloadFiltered" disabled>Download Filtered Output</button>
                                <span class="filter-hint">Uses current output format and export format.</span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="action-bar">
                <div class="action-left">
                    <button class="btn-ghost" id="prevStep">Previous</button>
                </div>
                <div class="action-right">
                    <button class="btn-secondary" id="nextStep">Next</button>
                    <button class="btn-primary" id="primaryAction">Go to Export</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
